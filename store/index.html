<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Studios - Store</title>
    <meta charset="UTF-8">
    <meta name="description" content="InfinityStudios">
    <meta name="keywords" content="Loja de Aplicativos & Jogos!">
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="./MarGamesStoresemfundo.png" type="image/x-icon">
</head>
<body>
    <div class="display">
        <div class="Infinity">
            <p><a href="https://infinitystudios.vercel.app"><img src="./infinity-studios-removebg-preview.png" height="70" width="70" id="MarGames"></a></p>
            <p><h1 id="infinitytitle">Infinity Studios</h1></p>
        </div>
    </div>
    <hr>
    <div class="Menu">
        <button id="slc">Store</button>
        <a href="./Aplicativos Oficiais/"><button>AppsOficiais</button></a>
    </div>
<button id="publicarBtn">ðŸ“¤ Publicar</button>
<div id="janelaPublicar" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%);
background:#1a1a1a; border:2px solid #333; padding:20px; border-radius:10px; z-index:999;">
  <h2>Publicar App ou Jogo</h2>
  <input id="nome" placeholder="Nome do app/jogo" style="width:100%; margin-bottom:8px;"><br>
  <textarea id="descricao" placeholder="DescriÃ§Ã£o" style="width:100%; height:60px; margin-bottom:8px;"></textarea><br>
  <input id="link" placeholder="Link do jogo (ex: https://...)" style="width:100%; margin-bottom:8px;"><br>
  <input id="icone" placeholder="Link do Ã­cone (opcional)" style="width:100%; margin-bottom:8px;"><br>
  <button id="enviarBtn">Enviar</button>
  <button id="fecharBtn">Fechar</button>
</div>
<script>
const btnPublicar = document.getElementById('publicarBtn');
const janela = document.getElementById('janelaPublicar');
const fechar = document.getElementById('fecharBtn');
const enviar = document.getElementById('enviarBtn');

btnPublicar.onclick = () => janela.style.display = 'block';
fechar.onclick = () => janela.style.display = 'none';

enviar.onclick = async () => {
  const nome = document.getElementById('nome').value.trim();
  const descricao = document.getElementById('descricao').value.trim();
  const link = document.getElementById('link').value.trim();
  const icone = document.getElementById('icone').value.trim();

  if(!nome || !descricao || !link) {
    alert('Preencha todos os campos obrigatÃ³rios!');
    return;
  }

  const res = await fetch('/api/publicar', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nome, descricao, link, icone })
  });

  const data = await res.json();
  alert(data.message);
  if(res.ok) janela.style.display = 'none';
};
</script>
<div id="listaApps" style="margin-top:40px; display:flex; flex-wrap:wrap; gap:16px;"></div>

<script>
async function carregarApps() {
  const res = await fetch('/api/apps');
  const apps = await res.json();

  const lista = document.getElementById('listaApps');
  lista.innerHTML = '';

  apps.forEach(app => {
    const card = document.createElement('div');
    card.style = `
      background:#1a1a1a; border:2px solid #333; padding:15px; border-radius:12px;
      width:200px; text-align:center; box-shadow:0 4px 10px #0003;
    `;

    const icone = app.icone ? 
      `<img src="${app.icone}" alt="${app.nome}" style="width:64px;height:64px;border-radius:12px;margin-bottom:10px;">`
      : `<div style="width:64px;height:64px;background:#333;border-radius:12px;margin:0 auto 10px;"></div>`;

    card.innerHTML = `
      ${icone}
      <h3 style="margin:0;font-size:18px;">${app.nome}</h3>
      <p style="font-size:13px;color:#aaa;">${app.descricao}</p>
      <a href="${app.link}" target="_blank" style="display:inline-block;margin-top:6px;color:#6ee7b7;text-decoration:none;">Abrir</a>
    `;
    lista.appendChild(card);
  });
}

carregarApps();

enviar.onclick = async () => {
  const nome = document.getElementById('nome').value.trim();
  const descricao = document.getElementById('descricao').value.trim();
  const link = document.getElementById('link').value.trim();
  const icone = document.getElementById('icone').value.trim();

  if(!nome || !descricao || !link) {
    alert('Preencha todos os campos obrigatÃ³rios!');
    return;
  }

  const res = await fetch('/api/publicar', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ nome, descricao, link, icone })
  });

  const data = await res.json();
  alert(data.message);
  if(res.ok) {
    janela.style.display = 'none';
    carregarApps();
  }
};
</script>
    </body>
</html>